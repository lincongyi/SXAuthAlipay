"use strict";(self["webpackChunklive_demo"]=self["webpackChunklive_demo"]||[]).push([[340],{2628:function(t,e,i){i.r(e),i.d(e,{default:function(){return W}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e("div",{staticClass:"wrap-top"},[1===t.recordStatus||3===t.recordStatus?e("div",{staticClass:"tip-title"},[t._v("è¯·é¢å‘å±å¹•å¼€å§‹å½•åˆ¶è§†é¢‘")]):t._e(),2===t.recordStatus?e("div",{staticClass:"tip-title"},[t._v("è¯·é¢å‘å±å¹• "+t._s(t.titles))]):t._e(),4===t.recordStatus?e("div",{staticClass:"tip-title"},[t._v("æ­£åœ¨æ£€æµ‹ä¸­...")]):t._e(),e("cw-video",{ref:"cwVideoRef",attrs:{showDefaultImg:!t.isOpenVideo,loading:t.loading},scopedSlots:t._u([{key:"imgSlot",fn:function(){return[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isOpenVideo,expression:"isOpenVideo"}],staticClass:"video-wrap",attrs:{id:"video-box"}},[e("video",{attrs:{id:"videoPlay",playinline:"",autoplay:""}})])]},proxy:!0}])})],1),e("div",{staticClass:"wrap-bottom"},[t.isShowInfo?e("TipInfo"):t._e(),t.isShowBtn?e("div",{staticClass:"op-btn"},[e("CwButton",{attrs:{loading:t.btnLoading},on:{click:t.openCamera}},[t._v("å¼€å§‹å½•åˆ¶è§†é¢‘")])],1):t._e()],1),e("CwNativeCameraPopup",{attrs:{titles:t.titles},on:{nativeRecord:t.nativeRecord,cancelClick:t.nativeCancelClick},model:{value:t.showNativeCamera,callback:function(e){t.showNativeCamera=e},expression:"showNativeCamera"}}),e("CwRsultPopup",{on:{reRecord:t.reRecord,cancelClick:t.cancelClick},model:{value:t.showResult,callback:function(e){t.showResult=e},expression:"showResult"}})],1)},o=[];function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}i(3948),i(8862);var c=function(){var t=this,e=t._self._c;return e("van-button",t._g(t._b({staticClass:"cw-button",attrs:{type:"primary",size:"large",color:"linear-gradient(135deg, #4C60BF 0%, #4C60BF 100%)",block:""}},"van-button",t.$attrs,!1),t.$listeners),[t._t("default")],2)},l=[],u={},p=u,d=i(1001),h=(0,d.Z)(p,c,l,!1,null,"a314852e",null),v=h.exports,w=i(338),m=function(){var t=this,e=t._self._c;return e("van-popup",t._g(t._b({staticClass:"cw-popup",attrs:{position:"bottom",round:"","close-on-click-overlay":!1}},"van-popup",t.$attrs,!1),t.$listeners),[e("div",{staticClass:"popup-content"},[e("div",{staticClass:"popup-title"},[t._v("è¯·ä¸Šä¼ è§†é¢‘")]),e("div",{staticClass:"popup-text"},[t._v("è¯·é¢å‘å±å¹•åšä»¥ä¸‹åŠ¨ä½œ:"+t._s(t.titles))]),e("div",{staticClass:"start-btn"},[e("CwButton",{on:{click:t.nativeRecord}},[t._v("å¼€å§‹å½•åˆ¶")])],1),e("div",{staticClass:"cancel-btn",on:{click:function(e){return t.$emit("cancelClick")}}},[t._v("é€€å‡º")])])])},f=[],C={props:{titles:{type:String,default:""}},components:{CwButton:v},methods:{nativeRecord(){this.$emit("nativeRecord")}}},g=C,b=(0,d.Z)(g,m,f,!1,null,"f9713bf6",null),_=b.exports,S=function(){var t=this,e=t._self._c;return e("van-popup",t._g(t._b({staticClass:"cw-popup",attrs:{position:"bottom",round:"","close-on-click-overlay":!1}},"van-popup",t.$attrs,!1),t.$listeners),[e("div",{staticClass:"popup-content"},[e("div",{staticClass:"popup-title"},[t._v("éªŒè¯å¤±è´¥")]),e("div",{staticClass:"popup-text"},[t._v("è¯·é¿å…ä¸€ä¸‹é—®é¢˜ï¼š")]),e("div",{staticClass:"popup-text"},[t._v("å¿˜è®°çœ¨çœ¼ã€é®æŒ¡äººè„¸ã€å…³ç…§ä¸å‡ã€æ‰‹æœºæ‘‡æ™ƒ")]),e("div",{staticClass:"popup-text"},[t._v(" å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»å®¢æœ "),e("span",{staticClass:"text-tel"},[t._v(t._s(t.telphone))])]),e("div",{staticClass:"start-btn"},[e("CwButton",{on:{click:t.reRecord}},[t._v("é‡æ–°å½•åˆ¶")])],1),e("div",{staticClass:"cancel-btn",on:{click:function(e){return t.$emit("cancelClick")}}},[t._v("é€€å‡º")])])])},k=[],R={components:{CwButton:v},data(){return{telphone:""}},mounted(){this.telphone=window.config.errorTelphone},methods:{reRecord(){this.$emit("reRecord")}}},y=R,O=(0,d.Z)(y,S,k,!1,null,"3fb88528",null),x=O.exports,P=i(6265),j=i.n(P),A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"static-tip-warp"},t._l(t.staticTip,(function(i){return e("div",{key:i.text,staticClass:"static-tip"},[e("div",{staticClass:"img"},[e("img",{attrs:{src:i.img}})]),e("div",{staticClass:"text"},[t._v(" "+t._s(i.text)+" ")])])})),0)},B=[],I=i.p+"static/img/tip-screen.80e38ae3.png",N=i.p+"static/img/tip-outline.02999415.png",F=i.p+"static/img/tip-light.52df7583.png",$={data(){return{staticTip:[{img:I,text:"æ­£å¯¹å±å¹•"},{img:N,text:"è½®å»“æ¸…æ™°"},{img:F,text:"äº®åº¦å‡åŒ€"}]}}},V=$,T=(0,d.Z)(V,A,B,!1,null,"2eb850c1",null),U=T.exports;const E=window.config.uploadUrl,L=window.config.actionNum||2;var M={components:{CwButton:v,CwVideo:w.Z,CwNativeCameraPopup:_,CwRsultPopup:x,TipInfo:U},data(){return{showNativeCamera:!1,showResult:!1,videoInstance:null,isSupport:!0,btnLoading:!1,recordStatus:1,activeActions:[],isUploadFinish:!1,actionsArr:[{title:"çœ¨çœ¨çœ¼",action:"1"},{title:"å¼ å¼ å˜´",action:"2"},{title:"æ‘‡æ‘‡å¤´",action:"5"}]}},computed:{isOpenVideo(){return this.isSupport&&2===this.recordStatus},isShowInfo(){return 1===this.recordStatus||3===this.recordStatus},isShowBtn(){return 1===this.recordStatus||3===this.recordStatus},loading(){return 4===this.recordStatus&&!this.isUploadFinish},titles(){const t=this.activeActions.map((t=>t.title));return t.join("ã€")},actions(){const t=this.activeActions.map((t=>t.action));return t.join(",")}},mounted(){this.initFs(),this.initVideo()},methods:{initFs(){if(1===L){const t=Math.floor(Math.random()*(this.actionsArr.length-1)+1);this.activeActions=this.actionsArr.filter(((e,i)=>i===t-1))}else if(2===L){const t=Math.floor(Math.random()*(this.actionsArr.length-1)+1);this.activeActions=this.actionsArr.filter(((e,i)=>i!==t-1))}else this.activeActions=[...this.actionsArr]},openCamera(){const t=this;t.isSupport?(t.btnLoading=!0,t.videoInstance.openCamera({onError(){console.warn("ä¸æ”¯æŒ"),t.showNativeCamera=!0,t.isSupport=!1,t.recordStatus=3,t.btnLoading=!1},onSuccess(){console.warn("æ”¯æŒ"),t.recordStatus=2,t.startCollect(),t.btnLoading=!1}})):t.showNativeCamera=!0},startCollect(){const t=(window.config.recordTime||5e3)/1e3;let e=!0;const i=this;i.videoInstance.startCollect({time:t,timeCallback(s){e&&(e=!1,i.$refs.cwVideoRef.start(t)),console.warn(s),s<=0&&(i.recordStatus=4)}})},initVideo(){this.recordStatus=1;const t=this;this.videoInstance=new CWMediaCollector({webmWasmPath:"./static/webm-wasm.wasm",webmWorkerPath:"./static/webm-worker.js",el:document.getElementById("video-box"),height:480,width:480,autoOpenNativeCamera:!1,mode:1,maxFileSize:10,frameRate:10,isFrontCamera:!0,mimeType:"video/webm;codecs=h264",onInitSuccess(e){20002===e.code?t.isSupport=!1:t.isSupport=!0},onSuccess:function(e){console.log("recordingEnd==",e),2e4===e.code?(console.log("å½•åˆ¶ç»“æŸäº†â€”â€”â€”â€”â€”â€”â€”â€”"),e.data?(t.postBlob(e.data),console.warn("å½•å–çš„æ•°æ®",e.data),t.recordStatus=4,t.showNativeCamera=!1):(console.warn("å½•åˆ¶çš„æ•°æ®ä¸º0"),t.showResult=!0)):t.showResult=!0},onError:function(e){console.log("ğŸš€ ~ html ~ initVideo ~ res",e,e.code,"--",e.message),console.log(e.message),t.showResult=!0}})},setResult(t){localStorage.setItem("result",JSON.stringify(t))},postBlob(t){const e=this;CWMediaCollector.blobToBase64(t,(function(t){console.warn("å½•åˆ¶çš„æ–‡ä»¶",t),console.warn("æ–‡ä»¶å¤§å°Byte",t.length),e.checkFace(t,(function(i){i.isAlive&&i.image?(e.setResult({result:!0,size:t.length,image:"data:image/jpeg;base64,"+i.image,res:i}),e.$router.push({path:"/result"})):(i.isAlive||0!==i.result)&&(i.isAlive||0===i.result)||(e.showResult=!0)}))}))},checkFace(t,e){const i=r(r({},window.config.uploadParameter||{}),{},{video:t,action:this.actions});this.isUploadFinish=!1,j().post(E,i).then((t=>{200===t.status?e(t.data):console.warn("å¤±è´¥status !== 200:",t.status)})).catch((t=>{console.warn("è¯·æ±‚å‡ºé”™:",t)})).finally((()=>{this.isUploadFinish=!0}))},reRecord(){console.warn("é‡æ–°å½•åˆ¶åŠŸèƒ½"),this.showResult=!1,this.$refs.cwVideoRef.init(),this.initFs(),this.initVideo()},nativeRecord(){this.videoInstance&&this.videoInstance.openNativeCamera()},onClickLeft(){console.warn("ç‚¹å‡»äº†è¿”å›é”®ç›˜");const t=window.config.returnUrl;location.href=t},cancelClick(){console.warn("ç‚¹å‡»äº†å¤±è´¥çš„é€€å‡ºåŠŸèƒ½");const t=window.config.failedUrl;location.href=t},nativeCancelClick(){const t=window.config.returnUrl;location.href=t}}},Z=M,D=(0,d.Z)(Z,s,o,!1,null,"379bd838",null),W=D.exports}}]);
//# sourceMappingURL=340.2eec14c6.js.map